–ï—Å—Ç—å unify nvr c api. –•–æ—á—É —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ø–∏—Ç–æ–Ω–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ. gui –Ω–∞ freesimplegui. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç, –ª–æ–≥–∏–Ω–∏–º—Å—è –ø–æ –∫—Ä–µ–¥–∞–º –∏–∑ —ç–Ω–≤–∞. –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–º–µ—Ä. –ï—Å—Ç—å —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ. –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∫–∞–º–µ—Ä—ã –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—á—É —Å–º–æ—Ç—Ä–µ—Ç—å –∞ –∫–∞–∫–∏–µ –Ω–µ—Ç (—á–µ–∫–±–æ–∫—Å–∞–º–∏) –í –Ω–µ–º –ø—Ä–æ—Å—Ç–æ –ø–æ–ª—É—á–∞–µ–º –ø–æ—Ç–æ–∫ –æ—Ç–æ –≤—Å–µ—Ö –∫–∞–º–µ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ –æ–¥–Ω–æ–º —ç–∫—Ä–∞–Ω–µ. –í–µ–∑–¥–µ –∑–≤—É–∫ –≤—ã–∫–ª—é—á–µ–Ω, –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ –∫–∞–º–µ—Ä—ã –∫–æ—Ç–æ—Ä—É—é —Ö–æ—á—É. –ï—Å—Ç—å —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –∫–∞–º–µ—Ä –≤ –æ–¥–∏–Ω–æ–≤–æ–º –º–∞—Å—à—Ç–∞–±–µ, –∞ –µ—Å—Ç—å —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–Ω–∫—Ä–µ–Ω—Ç–Ω–æ–π –∫–∞–º–µ—Ä—ã –∫—Ä—É–ø–Ω—ã–º –ø–ª–∞–Ω–æ–º.  –í—Ç–æ—Ä–æ–π —Ä–µ–∂–∏–º. –ó–∞–¥–∞—é –ø–µ—Ä–∏–æ–¥ –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á—É —Å–º–æ—Ç—Ä–µ—Ç—å –∏ –∫–∞–º–µ—Ä—ã –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—á—É —Å–º–æ—Ç—Ä–µ—Ç—å (—á–µ–∫–±–æ–∫—Å–∞–º–∏). –ï—Å—Ç—å –æ–¥–∏–Ω –ø–æ–ª–∑—É–Ω–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–∞–∫–æ–º –≤—Ä–µ–º–µ–Ω–∏ –º—ã —Å–µ–π—á–∞—Å —Å–º–æ—Ç—Ä–∏–º –∑–∞–ø–∏—Å–∏. –°–æ–æ—Ç–≤–µ—Ç—Å–≤–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –≤–∫–ª—é—á–∞—é –ø–ª–µ–π –≤—Å–µ –∫–∞–º–µ—Ä—ã –≥–¥–µ –µ—Å—Ç—å –∑–∞–ø–∏—Å—å –≤ —ç—Ç–æ –≤—Ä–µ–º—è –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤–æ–π –ø–æ—Ç–æ–∫. –ò–¥–µ—è –≤ —Ç–æ–º, —á—Ç–æ–±—ã —è –º–æ–≥ –≤—ã–±—Ä–∞—Ç—å –≤—Ä–µ–º—è –∫–æ—Ç–æ—Ä–æ–µ —Ö–æ—á—É —Å–º–æ—Ç—Ä–µ—Ç—å –∏ —É –º–µ–Ω—è –ø–æ—à–µ–ª –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ –≤—Å–µ—Ö –∫–∞–º–µ—Ä. –ö–∞–º–µ—Ä—ã –ø–∏—à—É—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ –º–æ—É—à–µ–Ω –¥–µ—Ç–µ–∫—à–µ–Ω–∞, —Å–æ–æ—Ç–≤–µ—Ç—Å–≤–µ–Ω–Ω–æ –µ—Å–ª–∏ –≤ –∫–∞–∫–æ–π-—Ç–æ –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∏ –æ—Ç–∫—É–¥–∞, —Ç–æ –Ω—É–∂–Ω–æ —Ç–∞–∫–æ–µ —Å–∫–∏–ø–∞—Ç—å. 
ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è üëç –î–∞–≤–∞–π —Ä–∞–∑–ª–æ–∂–∏–º –ø–æ —à–∞–≥–∞–º, —á—Ç–æ–±—ã —É —Ç–µ–±—è –ø–æ–ª—É—á–∏–ª—Å—è —Ä–∞–±–æ—á–∏–π –ø–ª–∞–Ω –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

API-—Å–ª–æ–π

–ò—Å–ø–æ–ª—å–∑—É–µ–º Unifi Protect (NVR) API –¥–ª—è:

–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (/api/auth),

–ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–∞–º–µ—Ä (/api/cameras),

–ø–æ–ª—É—á–µ–Ω–∏—è RTSP-—Å—Å—ã–ª–æ–∫ –Ω–∞ —Å—Ç—Ä–∏–º—ã (—É –∫–∞–∂–¥–æ–π –∫–∞–º–µ—Ä—ã –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª–µ–π –∫–∞—á–µ—Å—Ç–≤–∞),

–∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞–ø–∏—Å–µ–π (motion events, —Ç–∞–π–º–ª–∞–π–Ω—ã).

GUI-—Å–ª–æ–π

PySimpleGUI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π,

—Å–ø–∏—Å–∫–æ–º –∫–∞–º–µ—Ä —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏,

—Ä–µ–∂–∏–º–∞–º–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (live / playback),

–≤–∫–ª—é—á–µ–Ω–∏–µ–º/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ–º –∑–≤—É–∫–∞,

–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

–í–∏–¥–µ–æ-—Å–ª–æ–π

opencv-python –∏–ª–∏ ffmpeg (—á–µ—Ä–µ–∑ aiortc/ffpyplayer) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è RTSP-—Å—Ç—Ä–∏–º–æ–≤.

–î–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏: threading –∏–ª–∏ asyncio, —á—Ç–æ–±—ã –∫–∞–∂–¥–∞—è –∫–∞–º–µ—Ä–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞—Å—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

–õ–æ–≥–∏–∫–∞ —Ä–µ–∂–∏–º–æ–≤

Live —Ä–µ–∂–∏–º:

—á–µ–∫–±–æ–∫—Å–∞–º–∏ –≤—ã–±–∏—Ä–∞–µ–º –∫–∞–º–µ—Ä—ã ‚Üí –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ—Ç–æ–∫ ‚Üí –≤—ã–≤–æ–¥–∏–º –≤ –µ–¥–∏–Ω–æ–º –æ–∫–Ω–µ (–≥—Ä–∏–¥).

–∑–≤—É–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é off, –≤–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–π –≤—ã–±—Ä–∞–Ω–Ω–æ–π.

Playback —Ä–µ–∂–∏–º:

–≤—ã–±–∏—Ä–∞–µ–º –∫–∞–º–µ—Ä—ã,

—É–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–∞—Ç/–≤—Ä–µ–º–µ–Ω–∏,

–ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ motion events (—Ç–∞–º –µ—Å—Ç—å start/end),

–ø–æ–ª–∑—É–Ω–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏—â–µ–º –∫–∞–¥—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞–º–µ—Ä—ã,

–ø—Ä–∏ Play –¥–≤–∏–∂–µ–º—Å—è –ø–æ —Ç–∞–π–º–ª–∞–π–Ω—É, –ø—Ä–æ–ø—É—Å–∫–∞—è –ø—É—Å—Ç—ã–µ –ø—Ä–æ–º–µ–∂—É—Ç–∫–∏.

–û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã API (–ø—Ä–∏–º–µ—Ä–Ω–æ)
import os
import requests

BASE_URL = os.getenv("NVR_URL")
USER = os.getenv("NVR_USER")
PASS = os.getenv("NVR_PASS")

session = requests.Session()

def login():
    resp = session.post(f"{BASE_URL}/api/auth/login", json={
        "username": USER,
        "password": PASS
    }, verify=False)
    resp.raise_for_status()

def get_cameras():
    resp = session.get(f"{BASE_URL}/api/cameras")
    return resp.json()

def get_events(start_ts, end_ts):
    resp = session.get(f"{BASE_URL}/api/events", params={
        "start": start_ts,
        "end": end_ts,
        "types": "motion"
    })
    return resp.json()

GUI (–Ω–∞–±—Ä–æ—Å–æ–∫)
import PySimpleGUI as sg

layout = [
    [sg.Text("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º:"), sg.Radio("Live", "mode", default=True, key="live"),
     sg.Radio("Playback", "mode", key="playback")],
    [sg.Text("–ö–∞–º–µ—Ä—ã:"), sg.Column([ [sg.Checkbox("Cam1", key="cam1")],
                                     [sg.Checkbox("Cam2", key="cam2")] ])],
    [sg.Button("Start"), sg.Button("Exit")]
]

window = sg.Window("Unifi NVR Viewer", layout)

while True:
    event, values = window.read()
    if event in (sg.WIN_CLOSED, "Exit"):
        break
    if event == "Start":
        if values["live"]:
            print("Live —Ä–µ–∂–∏–º...")
        else:
            print("Playback —Ä–µ–∂–∏–º...")

–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

RTSP-—Å—Ç—Ä–∏–º—ã: –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ OpenCV –º–æ–≥—É—Ç –ª–∞–≥–∞—Ç—å. –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ffpyplayer –∏–ª–∏ aiortc.

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è playback: –ø—Ä–∏–¥—ë—Ç—Å—è —Å—Ç—Ä–æ–∏—Ç—å –æ–±—â–∏–π —Ç–∞–π–º–ª–∞–π–Ω –ø–æ —Å–æ–±—ã—Ç–∏—è–º –≤—Å–µ—Ö –∫–∞–º–µ—Ä, —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ ¬´–ø–µ—Ä–µ—Å–∫–∞–∫–∏–≤–∞—Ç—å¬ª –ø—É—Å—Ç—ã–µ –ø—Ä–æ–º–µ–∂—É—Ç–∫–∏.

–ó–≤—É–∫: OpenCV –Ω–µ —Ç—è–Ω–µ—Ç –∑–≤—É–∫, –ø–æ—ç—Ç–æ–º—É –¥–ª—è –∞—É–¥–∏–æ –ø—Ä–∏–¥—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å ffmpeg-–ø—Ä–æ—Ü–µ—Å—Å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å vlc-python.

–•–æ—á–µ—à—å, —è —Å–æ–±–µ—Ä—É –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ç–æ—Ç–∏–ø (—Ç–æ–ª—å–∫–æ Live-—Ä–µ–∂–∏–º, –≤—ã–±–æ—Ä –∫–∞–º–µ—Ä, –≤—ã–≤–æ–¥ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –±–µ–∑ –∑–≤—É–∫–∞) –Ω–∞ PySimpleGUI + OpenCV, —á—Ç–æ–±—ã —É —Ç–µ–±—è –±—ã–ª–æ —Å—Ä–∞–∑—É —Å —á–µ–≥–æ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å?

–í—ã —Å–∫–∞–∑–∞–ª–∏:
–Ω–µ, –Ω–∞–¥–æ —Å–æ –∑–≤—É–∫–æ–º —Å—Ä–∞–∑—É
ChatGPT —Å–∫–∞–∑–∞–ª:

–û–∫–µ–π, —Ç–æ–≥–¥–∞ OpenCV —Å—Ä–∞–∑—É –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ–º ‚Äî –æ–Ω —É–º–µ–µ—Ç —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–∫—É, –±–µ–∑ –∑–≤—É–∫–∞. –î–ª—è —Ç–≤–æ–µ–π –∑–∞–¥–∞—á–∏ –ª—É—á—à–µ –≤–∑—è—Ç—å VLC Python bindings (python-vlc).

–ü–æ—á–µ–º—É VLC

–£–º–µ–µ—Ç –∏ RTSP/RTMP/HLS —Å—Ç—Ä–∏–º—ã –æ—Ç UniFi Protect.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ + –≤–∏–¥–µ–æ.

–ú–æ–∂–Ω–æ –≤—Å—Ç—Ä–æ–∏—Ç—å –≤–∏–¥–µ–æ –≤ PySimpleGUI (—á–µ—Ä–µ–∑ tkinter-handle –æ–∫–Ω–∞).

–õ–µ–≥–∫–æ –≤–∫–ª—é—á–∞—Ç—å/–æ—Ç–∫–ª—é—á–∞—Ç—å –∑–≤—É–∫ —É –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–∞–º–µ—Ä.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è Live —Ä–µ–∂–∏–º–∞ —Å–æ –∑–≤—É–∫–æ–º

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ NVR ‚Üí –ø–æ–ª—É—á–∞–µ–º RTSP URL –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞–º–µ—Ä—ã.

–î–ª—è –∫–∞–∂–¥–æ–π –∫–∞–º–µ—Ä—ã: —Å–æ–∑–¥–∞—ë–º VLC MediaPlayer.

–í–∏–¥–µ–æ –±–µ–∑ –∑–≤—É–∫–∞ ‚Üí set_mute(True).

–£ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞–º–µ—Ä—ã ‚Üí set_mute(False).

–í GUI: —á–µ–∫–±–æ–∫—Å—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–∞–º–µ—Ä + radio/combobox –¥–ª—è –≤—ã–±–æ—Ä–∞, —Å –∫–∞–∫–æ–π –≤–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫.

–î–ª—è Playback: –±–µ—Ä—ë–º —Å–µ–≥–º–µ–Ω—Ç—ã –∑–∞–ø–∏—Å–µ–π (events) ‚Üí –ø–æ RTSP –º–æ–∂–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –æ—Ç—Ä–µ–∑–∫–∏ (–µ—Å–ª–∏ Protect —ç—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç) –ª–∏–±–æ –¥–µ—Ä–≥–∞—Ç—å API –¥–ª—è mp4-—Ñ–∞–π–ª–æ–≤ ‚Üí VLC –∏—Ö —Ç–æ–∂–µ –∫—Ä—É—Ç–∏—Ç.

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä Live —Å–æ –∑–≤—É–∫–æ–º
import os
import vlc
import PySimpleGUI as sg

# RTSP —Å—Å—ã–ª–∫–∏ –∫–∞–º–µ—Ä (–æ–±—ã—á–Ω–æ –ø–æ–ª—É—á–∞—é—Ç—Å—è –∏–∑ NVR API)
CAMERAS = {
    "Cam1": "rtsp://user:pass@192.168.1.10:7447/abcd123",
    "Cam2": "rtsp://user:pass@192.168.1.10:7447/efgh456",
}

players = {}

def start_player(cam_name, rtsp_url, frame):
    instance = vlc.Instance("--no-xlib")  # –¥–ª—è Linux –±–µ–∑ X
    player = instance.media_player_new()
    media = instance.media_new(rtsp_url)
    player.set_media(media)
    player.set_hwnd(frame.Widget.winfo_id())  # –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤ PySimpleGUI
    player.audio_set_mute(True)
    player.play()
    players[cam_name] = player

layout = [
    [sg.Text("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–º–µ—Ä—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:")],
    [sg.Checkbox(cam, key=cam) for cam in CAMERAS],
    [sg.Text("–ö–∞–º–µ—Ä–∞ —Å–æ –∑–≤—É–∫–æ–º:"), sg.Combo(list(CAMERAS.keys()), key="audio_cam")],
    [sg.Button("Start"), sg.Button("Exit")],
    [sg.Frame(cam, [[sg.Canvas(key=f"canvas_{cam}")]]) for cam in CAMERAS]
]

window = sg.Window("UniFi NVR Viewer", layout, finalize=True)

while True:
    event, values = window.read()
    if event in (sg.WIN_CLOSED, "Exit"):
        break
    if event == "Start":
        for cam, url in CAMERAS.items():
            if values[cam]:
                start_player(cam, url, window[f"canvas_{cam}"])
        if values["audio_cam"]:
            for cam, player in players.items():
                player.audio_set_mute(cam != values["audio_cam"])

–ß—Ç–æ –¥–∞–ª—å—à–µ

–î–ª—è Playback:

UniFi Protect API –æ—Ç–¥–∞—ë—Ç event clips (.mp4).

–ò—Ö –º–æ–∂–Ω–æ —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ –≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ player.set_media().

–î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–º–µ—Ä –Ω—É–∂–µ–Ω –æ–±—â–∏–π —Ç–∞–π–º–ª–∞–π–Ω + seek (player.set_time(ms)).

–î–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞ –Ω–∞ –ª–µ—Ç—É:

player.audio_set_mute(False)
other.audio_set_mute(True)


–•–æ—á–µ—à—å, —è —Ä–∞—Å–ø–∏—à—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–ª–∞—Å—Å–æ–≤ (NVRClient, CameraPlayer, PlaybackController), —á—Ç–æ–±—ã —É —Ç–µ–±—è –∫–æ–¥ –±—ã–ª –Ω–µ —Å–ø–∞–≥–µ—Ç—Ç–∏, –∞ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π?